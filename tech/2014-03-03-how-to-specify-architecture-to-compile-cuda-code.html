<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Ashwin Nanjappa">
  <title>Code Yarns ‚Äì How to specify architecture to compile CUDA code</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="../styles.css">
  <!-- RSS feed -->
  <link rel="alternate" type="application/rss+xml" href="https://codeyarns.com/tech/rss.xml" />
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143311697-1">
  </script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-143311697-1');
  </script>
  <!-- Google Adsense -->
  <script data-ad-client="ca-pub-1956250892185343" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
  </script>
  <!-- Twitter button -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</head>

<body>

<div class="contentbox">
<div class="header">
    <a href=".." class="header">Code Yarns ‚Äçüë®‚Äçüíª</a>
  </div>
  <div class="header">
    <a class="header2" href="https://codeyarns.com/tech/">Tech Blog</a> ‚ùñ <a class="header2" href="https://codeyarns.com/personal/">Personal Blog</a>
  </div>
  <div class="header" style="padding-top: 10px;">
    <iframe src="https://duckduckgo.com/search.html?site=codeyarns.com&kp=-2&kc=1&prefill=Search this website" style="width:300px;height:40px;" frameborder="0"></iframe>
</div>
</div>

<br />

<div class="contentbox">
<header>
<h1 class="title">How to specify architecture to compile CUDA code</h1>
<p class="date">üìÖ 2014-Mar-03 ‚¨© ‚úçÔ∏è Ashwin Nanjappa ‚¨© üìö <a href="index.html">Archive</a></p>
</header>
<p>To compile CUDA code, you need to indicate what architecture you want to compile for. And this gets quite confusing because there are three options that can be used: <code>-arch</code>, <code>-code</code> and <code>-gencode</code>.</p>
<p>It does not have to be this complicated, but due to historical and practical reasons it just is. The best way to understand how to use these options is to recall the two-level hierarchy of CUDA architecture. First, is the high-level PTX architecture that acts as a virtual machine. Next, is a class of low-level GPU architectures that are designed to work with the features available in a particular PTX architecture.</p>
<p>This is conceptually how a CUDA compiler works too. For the sake of these compiler options, we can break down the compilation phase into two stages. First, the compiler looks at high-level features that are supported by a particular virtual PTX architecture and creates high-level code for that architecture. Next, the compiler translates the PTX code to the SASS code that is optimized for a particular low-level GPU architecture.</p>
<h2 id="arch">-arch</h2>
<p>This compiler option is used to tell the compiler what PTX architecture to aim for in the first stage of compilation. PTX architectures are specified in the format of <code>compute_xy</code>, where <code>xy</code> is the version number of a particular architecture.</p>
<p>For example:</p>
<pre><code>-arch=compute_35</code></pre>
<p>This makes the compiler produce PTX code that the CUDA driver will JIT-compile at runtime to SASS code that will work on all <code>sm_35</code> GPU architectures.</p>
<p>You can also specify a low-level GPU architecture to this option:</p>
<pre><code>-arch=sm_35</code></pre>
<p>This makes the compiler produce SASS code that will work correctly only on <code>sm_35</code> GPU. The compiler will pick the PTX architecture that is suitable for <code>sm_35</code> in the first stage, even though you have not indicated that to it.</p>
<p>Note that only one PTX architecture can be specified using <code>-arch</code> option.</p>
<h2 id="code">-code</h2>
<p>This compiler option is used to tell the compiler what SASS architecture to aim for in the second stage of compilation. It will pick the PTX architecture that is suitable for the SASS architecture you specified.</p>
<p>For example:</p>
<pre><code>-code=sm_21</code></pre>
<p>This makes the compiler produce SASS code that will work correctly only on <code>sm_21</code> GPU.</p>
<p>You can specify many SASS architectures, but they should all belong to the same class of PTX architecture.</p>
<p>For example:</p>
<pre><code>-code=sm_20,sm_21</code></pre>
<h2 id="arch--code">-arch -code</h2>
<p>These two options can be combined to be more specific (and also confusing). Let us see some examples.</p>
<pre><code>-arch=compute_20 -code=sm_20</code></pre>
<p>Produces SASS code for <code>sm_20</code>.</p>
<pre><code>-arch=compute_20 -code=compute_20,sm_20,sm_21</code></pre>
<p>Produces PTX code for <code>compute_20</code> and SASS code for both <code>sm_20</code> and <code>sm_21</code> GPUs.</p>
<h2 id="gencode">-gencode</h2>
<p>What if you want to produce PTX or SASS code for many PTX architectures? That is what this option is useful for.</p>
<pre><code>-gencode arch=compute_20,code=sm_20</code></pre>
<p>This usage is similar to earlier. But, the real use is to produce for many PTX architectures, like this:</p>
<pre><code>-gencode arch=compute_20,code=compute_20 -gencode arch=compute_35,code=sm_35</code></pre>
<h2 id="compute_xy">Compute_XY</h2>
<p>The different <code>compute_xy</code> values that can be specified are:</p>
<pre><code>compute_10
compute_11
compute_12
compute_13
compute_20
compute_30
compute_35</code></pre>
<h2 id="sm_xy">SM_XY</h2>
<p>The different <code>sm_xy</code> values that can be specified are:</p>
<pre><code>sm_10
sm_11
sm_12
sm_13
sm_20
sm_21
sm_30
sm_35</code></pre>
<p><strong>Reference:</strong> NVCC Manual, CUDA 5.5</p>
</div>

<br />

<div class="contentbox">

<div class="footer"><a href="mailto:codeyarns@gmail.com" style="text-decoration: none; font-size: xx-large;">üìß</a> <a href="https://twitter.com/codeyarns" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @codeyarns</a> <a href="https://www.buymeacoffee.com/codeyarns"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" style="height: 38px !important;width: 163px !important;" ></a></div>
</div>

</body>
</html>
