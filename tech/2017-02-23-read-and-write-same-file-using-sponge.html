<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Ashwin Nanjappa" />
  <title>Code Yarns â€“ Read and write same file using sponge</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143311697-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-143311697-1');
  </script>
  <!-- CSS styles -->
  <style>
  p.caption {
      text-align: center;
  }
  img {
      max-width: 90%;
      display: block;
      margin: 0 auto;
  }
  </style>
</head>
<body>
<a href="..">Code Yarns</a> / <a href="index.html">Tech Blog</a>
<hr />
<div id="header">
<h1 class="title">Read and write same file using sponge</h1>
<h3 class="date">2017-02-23 15:00:27+00:00</h3>
</div>
<p>A common operation I end up doing is reading a text file, processing it using Unix tools and writing back the result to the same filename. However, if you do this you will find that you end up with an empty file! This is because the file is first opened for writing, thus clearing its contents.</p>
<p><strong>sponge</strong> is a tiny tool created specially for this common operation. It can be installed easily:</p>
<pre><code>$ sudo apt install moreutils</code></pre>
<p>Here is an example that is wrong and ends up creating an empty file:</p>
<pre><code>$ cat foobar.txt | uniq &gt; foobar.txt</code></pre>
<p>To fix this, add sponge to <em>soak</em> up all the output first and only write to the file at the end:</p>
<pre><code>$ cat foobar.txt | uniq | sponge foobar.txt</code></pre>
<p><strong>Tried with:</strong> moreutils 0.57 and Ubuntu 16.04</p>
<hr />
<p><a href="rss.xml">RSS</a> - <a href="mailto:codeyarns@gmail.com">Contact</a></p>
</body>
</html>
