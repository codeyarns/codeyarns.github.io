<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Ashwin Nanjappa">
  <title>Code Yarns ‚Äì nvidia-smi cheatsheet</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="../styles.css">
  <!-- RSS feed -->
  <link rel="alternate" type="application/rss+xml" href="https://codeyarns.com/tech/rss.xml" />
  <!-- Microsoft Clarity Analytics -->
  <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "3wadqgw95m");
  </script>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143311697-1">
  </script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-143311697-1');
  </script>
  <!-- Google Adsense -->
  <script data-ad-client="ca-pub-1956250892185343" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js">
  </script>
  <!-- Twitter button -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</head>

<body>

<div class="contentbox">
<div class="header">
    <a href=".." class="header">Code Yarns ‚Äçüë®‚Äçüíª</a>
  </div>
  <div class="header">
    <a class="header2" href="https://codeyarns.com/tech/">Tech Blog</a> ‚ùñ <a class="header2" href="https://codeyarns.com/personal/">Personal Blog</a>
  </div>
  <div class="header" style="padding-top: 10px;">
    <iframe src="https://duckduckgo.com/search.html?site=codeyarns.com&kp=-2&kc=1&prefill=Search this website" style="width:300px;height:40px;" frameborder="0"></iframe>
</div>
</div>

<br />

<div class="contentbox">
<header>
<h1 class="title">nvidia-smi cheatsheet</h1>
<p class="date">üìÖ 2019-Apr-26 ‚¨© ‚úçÔ∏è Ashwin Nanjappa ‚¨© üè∑Ô∏è <a href='index.html#cheatsheet'>cheatsheet</a>, <a href='index.html#nvidia-smi'>nvidia-smi</a> ‚¨© üìö <a href="index.html">Archive</a></p>
</header>
<p><a href="https://developer.nvidia.com/nvidia-system-management-interface"><strong>nvidia-smi</strong></a> (NVIDIA System Management Interface) is a tool to query, monitor and configure NVIDIA GPUs. It ships with and is installed along with the NVIDIA driver and it is tied to that specific driver version. It is a tool written using the <a href="https://developer.nvidia.com/nvidia-management-library-nvml"><strong>NVIDIA Management Library (NVML)</strong></a>.</p>
<h2 id="query-status-of-gpus">Query status of GPUs</h2>
<pre><code>$ nvidia-smi</code></pre>
<p>This outputs a summary table, where I find the following information useful:</p>
<ul>
<li>Version of driver.</li>
<li>Names of the GPUs.</li>
<li>Index of the GPUs, based on PCI Bus Order. This is different from the CUDA order.</li>
<li>Amount of memory each of the GPUs has.</li>
<li>Whether persistence mode is enabled on each of the GPUs</li>
<li>Utilization of each of the GPUs (if I‚Äôm running something on them).</li>
<li>List of processes executing on the GPUs.</li>
</ul>
<h2 id="query-parameters-of-gpus">Query parameters of GPUs</h2>
<pre><code>$ nvidia-smi -q</code></pre>
<p>Some of the information I find useful in this is:</p>
<ul>
<li>Default clocks (listed under <strong>Default Application Clocks</strong>). These are a stable pair of graphics (or SM) and memory clock values I can lock this GPU to.</li>
<li>Current clocks (listed under <strong>Application Clocks</strong>). These values might vary when you are running a workload on the GPU.</li>
</ul>
<p>To query the parameters of a particular GPU, use its index:</p>
<pre><code>$ nvidia-smi -q -i 9</code></pre>
<h2 id="query-supported-clock-values">Query supported clock values</h2>
<p>To list the supported pairs of memory and graphics clock values:</p>
<pre><code>$ nvidia-smi -q -d SUPPORTED_CLOCKS
$ nvidia-smi -q -d SUPPORTED_CLOCKS -i 3</code></pre>
<p>Typically, there are only a few supported memory clock values, while the number of supported graphics clock values is high with a fine granularity.</p>
<h2 id="query-current-values-of-gpus">Query current values of GPUs</h2>
<ul>
<li>To view how much power is being consumed by GPUs in watts:</li>
</ul>
<pre><code>$ nvidia-smi --query-gpu=gpu_name,power.draw --format=csv</code></pre>
<ul>
<li>To view the VBIOS version of your GPUs:</li>
</ul>
<pre><code>$ nvidia-smi --query-gpu=gpu_name,vbios_version --format=csv</code></pre>
<ul>
<li>To view the PCI device-vendor ID of your GPUs:</li>
</ul>
<pre><code>$ nvidia-smi --query-gpu=pci.device_id --format=csv
pci.device_id
0x1D8110DE</code></pre>
<p>In the above output, <code>0x1D81</code> is the device ID and <code>0x10DE</code> is the NVIDIA vendor ID.</p>
<ul>
<li>To query the range of power (limits in watts) that can be set for a GPU:</li>
</ul>
<pre><code>$ nvidia-smi --query-gpu=gpu_name,power.min_limit,power.max_limit --format=csv

name, power.min_limit [W], power.max_limit [W]
TITAN V, 100.00 W, 300.00 W
Quadro RTX 8000, 100.00 W, 260.00 W</code></pre>
<p>To actually set the power limit for a GPU:</p>
<pre><code>$ nvidia-smi -i 0 -pl 250</code></pre>
<p>If you try to set an invalid power limit, the command will complain and not do it. This command also seems to disable persistence mode, so you will need to enable it again.</p>
<ul>
<li>To view all the properties, like <code>gpu_name</code>, <code>power.draw</code> or <code>vbios_version</code>, that can be queried for your GPUs:</li>
</ul>
<pre><code>$ nvidia-smi --help-query-gpu</code></pre>
<p>You must be able to find pretty much every detail of your GPU by using the above command.</p>
<h2 id="display-gpu-statistics-in-scrolling-format">Display GPU statistics in scrolling format</h2>
<ul>
<li>To get a scrolling display of GPU statistics displayed continuously:</li>
</ul>
<pre><code>$ nvidia-smi dmon

# gpu   pwr gtemp mtemp    sm   mem   enc   dec  mclk  pclk
# Idx     W     C     C     %     %     %     %   MHz   MHz
    0    27    47    44     0     0     0     0   850   135
    1    25    33     -     0     1     0     0   405   300
    0    27    47    44     0     0     0     0   850   135
    1    25    33     -     0     1     0     0   405   300</code></pre>
<ul>
<li>To get a scrolling display of power consumed, GPU and memory temperatures, and current GPU and memory clock values:</li>
</ul>
<pre><code>$ nvidia-smi dmon -s pc

# gpu   pwr gtemp mtemp  mclk  pclk
# Idx     W     C     C   MHz   MHz
    0    27    46    44   850   135
    1    25    33     -   405   300
    0    27    47    44   850   135
    1    30    33     -   405   300</code></pre>
<ul>
<li>To see all the different statistics that can be displayed in scrolling format and other configuration options:</li>
</ul>
<pre><code>$ nvidia-smi dmon -h

    GPU statistics are displayed in scrolling format with one line
    per sampling interval. Metrics to be monitored can be adjusted
    based on the width of terminal window. Monitoring is limited to
    a maximum of 4 devices. If no devices are specified, then up to
    first 4 supported devices under natural enumeration (starting
    with GPU index 0) are used for monitoring purpose.
    It is supported on Tesla, GRID, Quadro and limited GeForce products
    for Kepler or newer GPUs under x64 and ppc64 bare metal Linux.

    Usage: nvidia-smi dmon [options]

    Options include:
    [-i | --id]:          Comma separated Enumeration index, PCI bus ID or UUID
    [-d | --delay]:       Collection delay/interval in seconds [default=1sec]
    [-c | --count]:       Collect specified number of samples and exit
    [-s | --select]:      One or more metrics [default=puc]
                          Can be any of the following:
                              p - Power Usage and Temperature
                              u - Utilization
                              c - Proc and Mem Clocks
                              v - Power and Thermal Violations
                              m - FB and Bar1 Memory
                              e - ECC Errors and PCIe Replay errors
                              t - PCIe Rx and Tx Throughput
    [-o | --options]:     One or more from the following:
                              D - Include Date (YYYYMMDD) in scrolling output
                              T - Include Time (HH:MM:SS) in scrolling output
    [-f | --filename]:    Log to a specified file, rather than to stdout
    [-h | --help]:        Display help information</code></pre>
<h2 id="set-gpu-clocks">Set GPU clocks</h2>
<ul>
<li>Typically, sudo permissions are required to set clocks. To allow unrestricted access to set clocks:</li>
</ul>
<pre><code>$ nvidia-smi -acp UNRESTRICTED</code></pre>
<ul>
<li>To reset the application clocks:</li>
</ul>
<pre><code>$ sudo nvidia-smi -rac
$ sudo nvidia-smi -i 9 -rac</code></pre>
<ul>
<li>To reset the graphics clocks:</li>
</ul>
<pre><code>$ sudo nvidia-smi -rgc
$ sudo nvidia-smi -i 9 -rgc</code></pre>
<ul>
<li>To enable or disable persistence mode of a GPU:</li>
</ul>
<pre><code>$ sudo nvidia-smi -pm 0
$ sudo nvidia-smi -i 9 -pm 0
$ sudo nvidia-smi -pm 1
$ sudo nvidia-smi -i 9 -pm 1</code></pre>
<p>It is recommended to enable persistence mode before locking clocks.</p>
<ul>
<li>To disable auto boost:</li>
</ul>
<pre><code>$ sudo nvidia-smi --auto-boost-default=DISABLED</code></pre>
<p>It is recommended to do this before locking clocks.</p>
<ul>
<li>To set application clocks, provide them in <code>mem,sm</code> format:</li>
</ul>
<pre><code>$ sudo nvidia-smi -i 9 -ac 1215,900</code></pre>
<ul>
<li>To set graphics clock:</li>
</ul>
<pre><code>$ sudo nvidia-smi -i 9 -lgc 900</code></pre>
<h2 id="mig">MIG</h2>
<p>nvidia-smi commands to deal with MIG can be found in my post <a href="2020-12-15-how-to-use-mig.html">How to use MIG</a>.</p>
</div>

<br />

<div class="contentbox">

<div class="footer"><a href="mailto:codeyarns@gmail.com" style="text-decoration: none; font-size: xx-large;">üìß</a> <a href="https://twitter.com/codeyarns" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @codeyarns</a> <a href="https://www.buymeacoffee.com/codeyarns"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" style="height: 38px !important;width: 163px !important;" ></a></div>
</div>

</body>
</html>
