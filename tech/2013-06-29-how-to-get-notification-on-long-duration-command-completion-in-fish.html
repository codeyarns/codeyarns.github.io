<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Ashwin Nanjappa" />
  <title>Code Yarns â€“ How to get notification on long duration command completion in Fish</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143311697-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'UA-143311697-1');
  </script>
  <!-- CSS styles -->
  <style>
  p.caption {
      text-align: center;
  }
  img {
      max-width: 90%;
      display: block;
      margin: 0 auto;
  }
  </style>
</head>
<body>
<a href="..">Code Yarns</a> / <a href="index.html">Tech Blog</a>
<hr />
<div id="header">
<h1 class="title">How to get notification on long duration command completion in Fish</h1>
<h3 class="date">2013-06-29 13:18:51+00:00</h3>
</div>
<p>Some commands take a long time to finish. For example, compiling C++ code or updating a lot of packages can take a while. Since the command completion time is long and variable, you might switch to a different task. But, you might want to be notified when that command is completed.</p>
<p>One technique to get such a <strong>notification</strong> in the <strong>Fish</strong> shell is by using the <code>CMD_DURATION</code> environment variable. Fish sets this to the number of milliseconds taken by the last executed command. It is set only if the last command took more than 1 second to complete.</p>
<p>By adding few lines of code to the <code>fish_prompt</code> function in the <code>~/.config/fish/functions/fish_prompt.fish</code> file, we can get a notification. I like to trigger a notification using the <strong>notify-send</strong> program, which displays a notification in Unity:</p>
<p>https://gist.github.com/ashwin/5891060</p>
<p>If you want to customize the display properties of the notification prompt, that can be done as explained in <a href="https://codeyarns.com/2015/05/14/how-to-configure-ubuntu-notifications/">this post</a>.</p>
<p><strong>Note:</strong></p>
<ul>
<li><p>You get a notification on your computer even if the command you are running is on a remote machine over SSH! For this to work, the Fish shell on the remote computer should have the above configuration files and you must have connected to it with X11 Forwarding enabled. A useful trick is to add the hostname of the computer to your notification message so that when it pops up you know which remote computer finished its command.</p></li>
<li><p>You need Fish v2.2 or later for this technique to work. In earlier versions <code>CMD_DURATION</code> is returned as a string value with different suffixes that is difficult to parse.</p></li>
</ul>
<p><strong>Reference:</strong> <a href="https://github.com/fish-shell/fish-shell/issues/1585">Weird format of CMD_DURATION</a></p>
<p><strong>Tried with:</strong> Fish 2.2b1 and Ubuntu 14.04</p>
<hr />
<p><a href="rss.xml">RSS</a> - <a href="mailto:codeyarns@gmail.com">Contact</a></p>
</body>
</html>
